---
title: "Trabajo Pr치ctico 3"
author: "Gazze - Irisarri - Landa"
date: "2024-05-23"
output: html_document
---

# Introducci칩n

Sumergirse en el mundo de la estad칤stica puede llevarnos a lugares inesperados, desafiando nuestras percepciones y llev치ndonos a explorar terrenos desconocidos. En esta ocasi칩n, nos sumergimos en un caso peculiar que fusiona el rigor anal칤tico con el misterio de una escena del crimen.

Nuestra historia se centra en Guido, un apasionado estudiante de estad칤stica cuyo amor por la resoluci칩n de enigmas lo llev칩 desde las aulas universitarias hasta las intrigantes calles de C칩rdoba.

Sin embargo, la emoci칩n de seguir su vocaci칩n se ve eclipsada por un oscuro suceso. En una madrugada envuelta en sombras, la unidad de trabajo de Guido es convocada de manera urgente para investigar un crimen reci칠n perpetrado en Salsipuedes. 

En medio del desorden, muebles destrozados, utensilios de cocina esparcidos y, en el centro de todo, el cuerpo inerte de Sergio Contreras, ba침ado en un charco de sangre. Ante esta escena, Guido se enfrenta a un desaf칤o crucial: determinar la hora en que se produjo la muerte.

![Imagen 1: Sergio minutos antes de su muerte](Imagen1.jpeg)

# Objetivos

El objetivo principal de este informe es utilizar m칠todos estad칤sticos con enfoque bayesiano para estimar con precisi칩n la hora de muerte de Sergio Contreras. A trav칠s del estudio de la temperatura corporal postmortem y la aplicaci칩n de modelos lineales, buscaremos proporcionar una estimaci칩n confiable del momento en que ocurri칩 el deceso. Adem치s, nuestro objetivo secundario es presentar los resultados de manera clara y concisa, demostrando un dominio completo del contenido y garantizando as칤 la obtenci칩n de una calificaci칩n sobresaliente (10游땔) en la evaluaci칩n del informe.

# Metodolog칤a

A trav칠s del an치lisis de la temperatura corporal, ecuaciones diferenciales y conceptos matem치ticos podremos descifrar el objetivo planteado. 

Sabemos que la temperatura del cuerpo de Segio satisface la siguiente ley:
 $$\frac{dT(t)}{dt}=r[T_{amb}-T(t)]$$
donde:

 * $T_{amb}$ es la temperatura ambiente (un valor fijo y conocido), 
 
 * $r$ es una constante y 
 
 * $T(t)$ es la funci칩n (en principio desconocida) que describe la temperatura del cuerpo en funci칩n del tiempo.

Se puede demostrar que Una funci칩n que satisface esa ecuaci칩n es $T(t)=T_{amb}+(T_i-T_{amb})e^{-rt}$
 
$$\frac{dT(t)}{dt}=\frac{d}{dt}(T(t)=T_{amb}+(T_i-T_{amb})e^{-rt})=$$
$$=(T_i-T_{amb})e^{-rt}(-r)=-r(T_i-T_{amb})e^{-rt}=$$
$$=-r(T_i-T_{amb})e^{-rt}+rT_{amb}-rT_{amb}=$$
$$=-r[(T_i-T_{amb})e^{-rt}+T_{amb}]+rT_{amb}=$$

$$=-r[T(t)-T_{amb}]=r[T_{amb}-T(t)]$$
donde:

 * $T_i$ la temperatura a la que est치 inicialmente el cuerpo de Sergio.
 
# Desarrollo

Para averiguar que indica la constante r, y que valores son coherentes, graficamos la funci칩n anterior para distintos valores de $r$, sabiendo que la temperatura del ambiente es $23춿C$ y la temperatura al momento de la muerte de Sergio es $37춿C$.
```{r, echo=FALSE, error=FALSE, warning=FALSE}
# Carga de paquetes
library(ggplot2)
library(gridExtra)
```

```{r, echo=FALSE, error=FALSE, warning=FALSE}
valores_r = c(-0.1, -0.3, 0, 0.1, 0.3, 1)
temp_desc <- function(valores_r){
  f <- c()
  r <- c()
  t <- seq(0, 24, length.out=200)
  for(i in 1:length(valores_r)){
    f <- c(f, 23+14*exp(-valores_r[i]*t))  
    r <- c(r,rep(valores_r[i], time = 200))
  }
  df <- data.frame(f, tiempos = rep(t, time = length(r)), r=factor(r))
  g1 <- ggplot(data = df)+
    aes(x = tiempos, y = f, color = r)+
    geom_line()+
    ylim(c(20, 60))+
    scale_x_continuous(breaks = 0:24)+
    labs(x = "Hora post mortem", y = "Temperatura corporal",
         caption = "Gr치fico 1:Temperatura corporal post mortem para distintos valores de r")+
    theme(plot.caption = element_text(hjust = 0.5))
  
  g1
}
temp_desc(valores_r)
```

Viendo los gr치ficos se puede decir que $r$ representa la rapidez con la que disminuye la temperatura corporal hasta llegar a la temperatura ambiente. Por esto sabemos que el valor de $r$ no puede ser negativo, ya que en estos casos vemos que la temperatura aumenta y no es coherente en este problema.

En general, durante las primeras 12 horas post mortem, la temperatura corporal suele disminuir a un ritmo de 0,5 a 1춿C por hora. Luego de este per칤odo, la tasa de enfriamiento se vuelve m치s lenta, aproxim치ndose a la temperatura ambiente en aproximadamente 24 horas.

Por lo tanto, llegamos a la conclusi칩n de que $0.1$ es un valor l칩gico para $r$, ya que en las primeras 12 horas, vemos una disminuci칩n de aproximadamente $0.8춿C$ por hora en la temperatura corporal.
 

Para responder nuestro objetivo tendremos en cuenta las siguientes consideraciones:
En lugar de considerar la temperatura del cuerpo, se considerar치 la diferencia entre la temperatura del cuerpo y la temperatura ambiente $(T-T_{amb})$. Adem치s, se llamar치 $T_{diff}$ a la diferencia entre la temperatura inicial del cuerpo y la temperatura ambiente $(T_i-T_{amb})$.

$$T(t)-T_{amb}=T_{diff}e^{-rt}$$
Para linealizar la ecuaci칩n aplicamos logaritmo natural a nuestra nueva variables $T(t)-T_{amb}$
$$ln(T(t)-T_{amb})=ln(T_{diff})-rt$$
Mostramos esto graficamente utilizando $r = 0.1$:
```{r}
r = 0.1
t <- seq(0, 24, length.out=200)
f <- 14*exp(-r*t)
ln_f <- log(f)
df2 <- data.frame(f = c(f,ln_f),t =c(t,t), funcion = rep(c("f", "ln_f"), each = 200))
g4 <- ggplot(data = df2)+
    aes(x = t, y = f, color = funcion)+
    geom_line()+
    labs(x = "Hora post mortem", y = "Diferencia entre la temperatura corporal y la temperatura amb.", 
         caption = "Gr치fico 2:")+
  theme(plot.caption = element_text(hjust = 0.5))
  

g4
```
 
 El intercepto de la funci칩n logaritmo de $T(t)-T_{amb}$ es $ln(T_{diff})=2.639$ , lo que indica que la diferencia entre la temperatura corporal y la temperatura ambiente en el momento de la muerte es $e^{2.639}춿C=14춿C$. La pendiente es $-r=-0.1$, esto significa que a medida que aumenta una hora, el logaritmo de la diferencia entre la temperatura corporal y la temperatura ambiente disminuye en $0.1춿C$.
 
A continuaci칩n se presentan los hechos transcurridos en la noche del fallecimiento de Sergio.
![Imagen 2: Cronolog칤a de los hechos](linea_tiempo.png)
 Likelihood:

 $Y_i| \beta_0, \beta_1, \sigma \sim N (\mu_i, \sigma)$
 $\mu_i = \beta_0 + \beta_1t $
 
 Priors:
 $\beta_0 \sim N(\mu=2.5, \sigma=1)$
 $\beta_1 \sim N(\mu=-0.1, \sigma=0.035)$
 $\sigma \sim N^+ (\theta=2.5)$
 
 son independientes
 Basandonos en los priors mencionados y el supuesto de que los parametros, podemos obtener la distribuci칩n predictiva a priori a trav칠s de muestras
 
```{r}
muestras_bo = rnorm(5000,2.5, 1)
muestras_b1 = rnorm(5000,-0.1, 0.035)
sigma = abs(rnorm(5000,0,2.5))
mu=muestras_bo + muestras_b1*t


df= data.frame(muestras_bo,muestras_b1,sigma,mu)
df$y_pred = rnorm(5000,df$mu,df$sigma)

ggplot(df) +
  geom_point(aes(x = t, y = ), alpha = 0.6, size = 2) +
  geom_abline(
    aes(intercept = beta0, slope = beta1),
    alpha = 0.3,
    color = "gray30",
1    data = df_draws_1[sample(nrow(df_draws_1), 40), ]
  ) +
  geom_abline(
    intercept = intercept_mean, 
    slope = slope_mean, 
    linewidth = 1, 
    color = "red"
  ) +
  labs(x = "Publicidad ($)", y = "Ventas ($)")

t <- seq(0,23, length.out=200)
for (i in 1:length(t)) {
  
}

```
 
 