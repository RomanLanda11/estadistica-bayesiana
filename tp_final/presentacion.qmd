---
format: revealjs
self-contained: true
---

## {background-image="img\caratula.png" background-size=cover}

## Introducción{background-color="#F2F2F2" .smaller}

El deterioro cognitivo leve (DCL) es una condición en la que las personas experimentan una disminución en sus habilidades cognitivas mayor a la esperada para su edad, sin que esto interfiera significativamente con su vida diaria. Aunque el DCL puede mantenerse estable durante años, es una señal de alerta porque puede progresar a enfermedades más graves, como la enfermedad de Alzheimer. El Alzheimer es la causa más común de demencia, se caracteriza por la acumulación de proteínas anormales en el cerebro, que dañan las neuronas y causan pérdida de memoria y otras capacidades cognitivas avanzadas. Estos cambios comienzan mucho antes de que los síntomas sean evidentes, por lo que la detección temprana es crucial.

## Preguntas de Investigación{background-color="#F2F2F2" .smaller}

Para nuestra investigación, vamos a abordar las siguientes preguntas clave:

#### Asociación con Patologías Neurodegenerativas:

-   ¿Cuáles de las variables morfológicas del cerebro están más asociadas con el DCL y el Alzheimer?

#### Predictores Demográficos:

-   ¿Qué características demográficas (como la edad y el sexo) pueden predecir los valores de estas variables morfológicas?

#### Impacto de la Tecnología:

-   ¿Hay alguna relación entre las características tecnológicas (como la marca del resonador y la intensidad del campo magnético) y las variables morfológicas que estamos interesados en estudiar?

## Abordaje{background-color="#F2F2F2" .smaller}

Para abordar este problema, primero realizaremos un análisis exploratorio de datos para entender mejor la distribución y las características de las variables disponibles. Posteriormente, utilizaremos un enfoque bayesiano en nuestro análisis para ajustar y comparar modelos para identificar las relaciones entre variables morfológicas del cerebro, características demográficas y el riesgo de desarrollar DCL o Alzheimer. Al evaluar la importancia de cada variable en la predicción de estas condiciones, podremos seleccionar el mejor modelo que represente los datos y las relaciones de manera más precisa. Nuestro objetivo final es mejorar nuestra comprensión de los factores que contribuyen al desarrollo de enfermedades neurodegenerativas.

## Descripción del Conjunto de Datos{.scrollable background-color="#F2F2F2"}

Utilizamos el conjunto de datos llamado `cerebros.csv`. Este conjunto incluye información de 128 pacientes que se sometieron a estudios de resonancia magnética en diferentes partes del mundo. Las variables en este conjunto de datos son:

-   **id**: Identificación del paciente.

-   **intensidad_campo**: Intensidad del campo magnético utilizado en la imagen (puede ser 3 T o 1.5 T). Sabemos que a mayor intensidad, se obtiene información más detallada de los pacientes.

-   **resonador_fab**: Marca del resonador (Phillips, Siemens, General Electric).

-   **edad**: Edad del paciente (en años).

-   **sexo**: Sexo del paciente.

-   **diag**: Diagnóstico, que puede ser HC (control sano), MCI (deterioro cognitivo leve) o AD (enfermedad de Alzheimer).

-   **lh_subcx_hippocampus_volume**: Es la medida del tamaño del hipocampo en el hemisferio izquierdo del cerebro (en mm³).

::: {layout-ncol=2}

![Imagen 1: Hipocampo](img/Hipocampo.png){width=300}

![Imagen 2: Hipocampo](img/Hipocampo2.png){width=300}

:::

-   **xh_general_etiv_volume**: Volumen intracraneal. Es el volumen total dentro del cráneo, incluyendo el cerebro, el líquido cerebroespinal y otros componentes (en mm³).

![Imagen 3: Volumen intercraneal](img/cerebro.png){width=300}

-   **lh_cortex_superiorfrontal_thickness**: Espesor de la corteza superior frontal. Es la medida del grosor de la corteza cerebral en la región superior del lóbulo frontal (en mm).

![Imagen 4: Corteza frontal superior](img/corteza_frontal_superior.png){width=300}

-   **lh_cortex_fusiform_volume**: Volumen de la corteza fusiforme, una región del cerebro situada en el lóbulo temporal. (en mm³).

![Imagen 5: Corteza Fusiforme](img/fusiforme2.png){width=300}

# Analisis Exploratorio{.smaller background-color="#F2F2F2"}

En primer instancia se realizo un `auto EDA` para elegir relaciones de interes y presentarlas con mayor profundidad. De alli surgió el interes en la variable/relaciones


```{r, echo=FALSE, warning=FALSE, message=FALSE}
# Carga de librerias
library(ggplot2)
library(patchwork)
library(readr)
library(rstan)
#carga de datos
df <- read_csv("data/cerebros.csv")
df$diag <- factor(df$diag, levels = c("HC", "MCI", "AD"))
```

```{r, echo=FALSE, warning=FALSE}
dist_edad <- ggplot(df) +
  aes(x = edad, y = ..density..) +
  geom_histogram(binwidth = 5, fill = "#53A6A6", alpha = 0.5) +
  geom_density(color = "#027368", size = 1) +
  labs(x = "Edad",
       y = "Densidad") +
  theme(plot.caption = element_text(hjust = 0))

edad_diag <- ggplot(df)+
  aes(x=edad, y= diag, fill=diag)+
  geom_boxplot()+
  labs(x = "Edad",
       y = "",
       fill = "Diagnóstico") +
  theme(plot.caption = element_text(hjust = 0))+
  scale_fill_manual(values = c("#BAD9D6", "#53A6A6", "#027368"))

hipo_diag <- ggplot(df)+
  aes(y = diag, x = lh_subcx_hippocampus_volume, fill=diag) +
  geom_boxplot( outlier.shape = NA) +
  labs(x = "Volumen de Hipocampo",
       y = "",
       fill = "Diagnóstico") +
   scale_fill_manual(values = c("#BAD9D6", "#53A6A6", "#027368"))+
  theme(plot.caption = element_text(hjust = 0))

dist_edad+edad_diag/hipo_diag&plot_annotation(caption = "Gráfico 1: Exploratorio de edad")&
  theme(plot.caption = element_text(hjust = 0))
```
## Analisis Exploratorio{ background-color="#F2F2F2"}
```{r, echo=FALSE, fig.width=10, fig.height=9, fig.align='center'}
g1 <- ggplot(df)+
  aes(x=edad, y=lh_subcx_hippocampus_volume,color=sexo)+
  geom_point()+
  geom_smooth(method = "lm", se=FALSE, color = "#027368")+
  labs(x = "", y = "Vol. Hipocampo")

g2 <- ggplot(df)+
  aes(x=edad, y=lh_cortex_superiorfrontal_thickness,color=sexo)+
  geom_point()+
  geom_smooth(method = "lm", se=FALSE, color = "#027368")+
  labs(x = "", y = "Espesor corteza sup. frontal")
g3 <- ggplot(df)+
  aes(x=edad, y=lh_cortex_fusiform_volume,color=sexo)+
  geom_point()+
  geom_smooth(method = "lm", se=FALSE, color = "#027368")+
  labs(x = "Edad", y = "Vol. Corteza fusiforme")

g4 <- ggplot(df)+
  aes(x=edad, y=xh_general_etiv_volume,color=sexo)+
  geom_point()+
  geom_smooth(method = "lm", se=FALSE, color = "#027368")+
  labs(x = "Edad", y = "Vol. Corteza fusiforme")

g1/g2/g3/g4/plot_annotation(caption = "Gráfico 2: Edad vs cuantitativas")&
  theme(plot.caption = element_text(hjust = 0))
```

## Analisis Exploratorio{ background-color="#F2F2F2"}

```{r, echo=FALSE, fig.width=8, fig.height=6, fig.align='center'}
# Gráfico de barras apiladas
campo_res <- ggplot(df, aes(x = factor(intensidad_campo), fill = resonador_fab)) +
  geom_bar(position = "fill", width = 0.7) +
  labs(x = "Intensidad de Campo",
       y = "Proporción",
       fill = "Resonador") +
  scale_fill_manual(values = c("#BAD9D6", "#53A6A6", "#027368"))+
  theme(plot.caption = element_text(hjust = 0))

campo_diag <- ggplot(df, aes(x = factor(intensidad_campo), fill = diag)) +
  geom_bar(position = "fill", width = 0.7) +
  labs(x = "Intensidad de Campo",
       y = "Proporción",
       fill = "Diagnóstico") +
   scale_fill_manual(values = c("#BAD9D6", "#53A6A6", "#027368"))+
  theme(plot.caption = element_text(hjust = 0))

sex_diag <- ggplot(df, aes(x = sexo, fill = diag)) +
  geom_bar(position = "fill", width = 0.7) +
  labs(x = "",
       y = "Proporción",
       fill = "Diagnóstico") +
   scale_fill_manual(values = c("#BAD9D6", "#53A6A6", "#027368"))+
  theme(plot.caption = element_text(hjust = 0))

res_diag <- ggplot(df, aes(x = resonador_fab, fill = diag)) +
  geom_bar(position = "fill", width = 0.7) +
  labs(x = "",
       y = "Proporción",
       fill = "Diagnóstico") +
   scale_fill_manual(values = c("#BAD9D6", "#53A6A6", "#027368"))+
  theme(plot.caption = element_text(hjust = 0))

(campo_res+campo_diag)/(sex_diag+res_diag)/plot_annotation(caption = "Gráfico 3: Exploratorio categoricas")&
  theme(plot.caption = element_text(hjust = 0))
```
## Diagnóstico vs Fábrica del resonador{background-color="#F2F2F2"}
$H_0)$ Las dos variables categóricas son independientes. Esto significa que la distribución de una variable es la misma en todas las categorías de la otra variable.

$H_1)$ Las dos variables categóricas no son independientes. Esto significa que la distribución de una variable es diferente en al menos una categoría de la otra variable.

```{r}
contingency_table <- table(df$diag, df$resonador_fab)
# Realizar el test de Chi-cuadrado de independencia
chisq.test(contingency_table)
```

# Propuesta y ajuste de modelos{background-color="#F2F2F2"}

## Descripción matemática{background-color="#F2F2F2"}

Considerando que nuestro interes esta en explicar que variables muestran o dan indicio de predisposicion a desarrollar una enfermedad neurodegenerativa, analizaremos nuestra respuesta `enfermedad` como una variable binaria que toma el valor 1 si el paciente tiene una enfermedad, o 0 si su control resultó sano.

```{r}
df$enfermedad <- ifelse(df$diag=="HC",0,1)
```

Modelaremos `enfermedad` como la respuesta de una regresión logística.
Los modelos que nos ayudan a responder los objetivos son los siguientes.

## Modelado {background-color="#F2F2F2" .smaller}

$$Enfermedad_i | \pi_i \sim Bernoulli(\pi_i) $$

$$logit(\pi_i) = \beta_0 + \beta_1 . \text{Vol Hipocampo}_i + \beta_2 . \text{Espesor Corteza Sup Frontal}_i +$$
$$+ \beta_3. \text{Vol Corteza Fusiforme}_i + \beta_4. \text{Vol Intracraneal}_i$$

$$Enfermedad_i | \pi_i \sim Bernoulli(\pi_i) $$

$$logit(\pi_i) = \beta_0 + \beta_1 . Edad_i + \beta_2 . Sexo_i$$
seleccion de modelos con intervalo de credibilidad 
ver si cambian mucho los coeficientes
modelo parsimonioso

```{r}
#Planteamos 8 modelos univariados y vemos cuales efectos resultan significativos
stan_data <- list(
  N = nrow(df),
  x = df$edad,
  y = df$enfermedad 
)

stan_model <- stan( 
      file ="modelo_x1.stan", 
      chains = 4,          # Cantidad de cadenas
      warmup = 100,
      data = stan_data,
      model_name = "modelo_tp",
      seed = 12119       # Para que el resultado sea reproducible
  )

```

